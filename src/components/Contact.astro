---
import Successfull from "./icons/contact/Successfull.astro";
---

<section id="contact" class="py-15 px-6 bg-background text-center">
  <div class="flex flex-col items-center justify-center gap-6">
    <h2 class="text-3xl font-bold text-foreground border-b-4 border-card-accent">
      Contacto
    </h2>

    <div
      class="flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-center lg:gap-10"
    >
      <div
        class="flex flex-col gap-4 items-start justify-start lg:items-center lg:text-md max-w-130 md:px-10"
      >
        <p class="text-muted-foreground leading-relaxed">
          Actualmente me encuentro abierto a oportunidades laborales y prácticas
          profesionales donde pueda aportar mis conocimientos como desarrollador
          Full Stack.
        </p>

        <p class="text-muted-foreground leading-relaxed mt-4">
          Si tienes una vacante o propuesta no dudes en contactarme. Estaré
          encantado de responder.
        </p>
      </div>

      <!-- formulario de contacto -->
      <form
        id="contactForm"
        class="space-y-4 max-w-xl lg:w-xl text-md font-sans"
      >
        <div
          class="flex items-center justify-center gap-2 bg-card py-1 px-4 border border-input"
        >
          <label for="name">Nombre:</label>
          <input
            type="text"
            name="name"
            placeholder="Tu nombre"
            required
            class="w-full p-3 rounded-lg text-card-foreground outline-none"
          />
        </div>

        <div
          class="flex items-center justify-center gap-2 bg-card py-1 px-4 border border-input"
        >
          <label for="email">Correo:</label>
          <input
            type="email"
            name="email"
            placeholder="Tu correo"
            required
            class="w-full p-3 rounded-lg text-card-foreground outline-none"
          />
        </div>
        <div class="flex flex-col gap-2 bg-card py-3 px-4 border border-input">
          <label for="message" class="text-start">Mensaje:</label>
          <textarea
            name="message"
            placeholder="Tu mensaje"
            rows="7"
            required
            class="w-full p-1 rounded-lg text-card-foreground outline-none resize-none row-end-5"
          ></textarea>
        </div>
        <button
          type="submit"
          class="w-full bg-black hover:bg-black/40 text-white font-semibold font-hero py-3 rounded-lg transition cursor-pointer border border-input hover:scale-102 duration-300"
        >
          Enviar
        </button>
      </form>
    </div>
  </div>
  <div
    id="statusContainer"
    class="status hidden fixed z-9999 bottom-5 mx-auto w-auto sm:right-10 sm:left-auto sm:mx-0 bg-foreground rounded-lg px-6 py-4 shadow-lg animate-slide-in text-center"
  >
    <div class="flex items-center gap-3">
      <div class="w-8 h-8 shrink-0">
        <Successfull />
      </div>
      <p id="status" class="text-background text-base font-medium">
        ¡Mensaje enviado correctamente!
      </p>
    </div>
  </div>
</section>

<script>
  import emailjs from "@emailjs/browser";

  const form = document.getElementById("contactForm") as HTMLFormElement;
  const statusContainer = document.getElementById(
    "statusContainer",
  ) as HTMLElement;

  if (form && statusContainer) {
    emailjs.init("ZHiOpLHFKZtmb7EIJ");

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const btn = form.querySelector("button");
      if (btn) {
        btn.innerText = "Enviando...";
        btn.disabled = true;
      }

      emailjs
        .sendForm("service_4675xmw", "template_v3ew4zh", form)
        .then(() => {
          // Éxito - Mostrar notificación
          statusContainer.classList.remove("hidden");
          statusContainer.classList.add("flex");

          form.reset();

          if (btn) {
            btn.innerText = "Enviar";
            btn.disabled = false;
          }

          // Ocultar mensaje después de 4 segundos
          setTimeout(() => {
            statusContainer.classList.add("hidden");
            statusContainer.classList.remove("flex");
          }, 4000);
        })
        .catch((error) => {
          console.error("Error:", error);
          alert("Error al enviar el mensaje. Por favor, intenta nuevamente.");

          if (btn) {
            btn.innerText = "Enviar";
            btn.disabled = false;
          }
        });
    });
  }
</script>

<!-- Opcional: Agregar animación de entrada -->
<style>
  @keyframes slide-in {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  .animate-slide-in {
    animation: slide-in 0.3s ease-out;
  }
</style>
